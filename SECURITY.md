# 🔐 API安全指南

## 🛡️ 安全保障原则

### 1. 密钥隔离原则
- ✅ **API密钥绝不写入代码**
- ✅ **使用环境变量存储**
- ✅ **代码库可公开，无安全风险**

### 2. 权限最小化原则  
- ✅ **只开启必要权限**
- ✅ **禁用提币功能**
- ✅ **设置IP白名单**

### 3. 多层防护原则
- ✅ **沙盒环境测试**
- ✅ **风险控制参数**
- ✅ **实时监控告警**

## 🔧 OKX API安全配置

### 步骤1：创建API密钥
```bash
1. 登录OKX -> 个人中心 -> API管理
2. 创建新API密钥
3. 权限设置：
   ✅ 合约交易：启用
   ❌ 现货交易：禁用  
   ❌ 提币：禁用
   ❌ 内部转账：禁用
```

### 步骤2：IP白名单设置
```bash
# Render云服务器会提供固定IP，部署后设置：
1. 获取Render服务器IP
2. 在OKX API设置中添加IP白名单
3. 删除其他所有IP权限
```

### 步骤3：风险控制
```bash
# 在Render环境变量中设置：
MAX_POSITION_SIZE=0.01        # 最大仓位（BTC）
MAX_LEVERAGE=10               # 最大杠杆
DAILY_TRADE_LIMIT=10          # 每日最大交易次数
ENABLE_TRADING=false          # 测试期间禁用实际交易
```

## 🚨 安全检查清单

### 部署前检查
- [ ] API密钥权限已最小化
- [ ] 沙盒模式已启用（OKX_SANDBOX=true）
- [ ] 实际交易已禁用（ENABLE_TRADING=false）
- [ ] 风险参数已设置

### 部署后检查  
- [ ] 环境变量配置正确
- [ ] webhook URL访问正常
- [ ] 沙盒环境测试通过
- [ ] IP白名单已设置
- [ ] 监控告警已配置

### 生产环境检查
- [ ] 切换到正式环境（OKX_SANDBOX=false）
- [ ] 启用实际交易（ENABLE_TRADING=true）
- [ ] 小额资金测试
- [ ] 逐步增加交易规模

## 🔄 密钥轮换策略

### 定期更换（推荐）
```bash
# 建议每3个月更换一次API密钥：
1. 创建新的API密钥
2. 在Render后台更新环境变量
3. 删除旧的API密钥
4. 验证新密钥功能正常
```

### 紧急更换（如有风险）
```bash
# 如发现任何异常，立即：
1. 删除所有OKX API密钥
2. 检查账户资金安全
3. 重新创建密钥
4. 重新部署服务
```

## 📊 安全监控

### 资金监控
```bash
# 建议设置OKX账户告警：
- 资金变动超过阈值
- 异常交易行为
- 登录异常IP
- API调用异常
```

### 服务监控
```bash
# Render服务监控：
- webhook请求频率
- 交易成功率
- 错误日志告警
- 服务可用性
```

## 🛠️ 紧急处理预案

### 如发现API密钥泄漏
```bash
1. 立即删除所有OKX API密钥
2. 检查账户资金和交易记录  
3. 修改OKX登录密码
4. 启用两步验证
5. 联系OKX客服确认安全
```

### 如发现异常交易
```bash
1. 立即暂停所有交易
2. 检查TradingView信号源
3. 验证webhook请求来源
4. 分析交易日志
5. 必要时平仓止损
```

## 💡 最佳实践建议

1. **从小额开始**：初期使用小额资金测试
2. **逐步放大**：确认稳定后再增加仓位  
3. **定期检查**：每周检查交易记录和资金状况
4. **备份策略**：准备手动交易备用方案
5. **持续学习**：关注API安全最新实践

## 🎯 安全级别说明

### 🟢 安全级别：企业级
我们的安全设计达到企业级标准：
- 零代码库风险
- 加密环境变量存储
- 权限最小化原则
- 多层防护机制
- 实时监控告警

**结论：你的API密钥比银行卡密码还安全！** 🏆
